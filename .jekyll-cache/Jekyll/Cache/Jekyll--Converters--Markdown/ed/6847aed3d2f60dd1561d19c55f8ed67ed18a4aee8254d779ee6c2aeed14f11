I"@<p>Today is a great day: with the announcement of Eclipse Mars, many great projects are released, and <a href="http://www.eclipse.org/sirius">Sirius</a> 3.0 is part of this release train.</p>

<p>When I have a look at the status of the Sirius project today, one soundtrack immediately comes to mind: <a href="https://en.wikipedia.org/wiki/File:Daft_Punk_-_Harder_Better_Faster_Stronger_(Album_Version).ogg">Harder, Better, Faster, Stronger</a></p>

<p><img src="https://upload.wikimedia.org/wikipedia/en/d/d2/Hbfs_single.jpg" alt="" /></p>

<h2 id="work-on-it-harder">Work on it harder</h2>

<p>One first fact, looking at the project’s statistics, is that the Sirius team worked hard on this release to deliver some new cool features and improve the existing ones:</p>

<table>

<tbody>

<tr>

<th>Version</th>

<th>Date</th>

<th>Total Closed</th>

<th>Feature Requests</th>

</tr>

<tr>

<td>1.0.0(Luna)</td>

<td>June 14</td>

<td>100</td>

<td>2</td>

</tr>

<tr>

<td>1.0.1</td>

<td>Aug 14</td>

<td>20</td>

<td>-</td>

</tr>

<tr>

<td>2.0.0</td>

<td>Oct 14</td>

<td>113</td>

<td>27</td>

</tr>

<tr>

<td>2.0.1</td>

<td>Nov 14</td>

<td>2</td>

<td>-</td>

</tr>

<tr>

<td>2.0.2</td>

<td>Dec 14</td>

<td>15</td>

<td>-</td>

</tr>

<tr>

<td>2.0.3</td>

<td>Jan 15</td>

<td>16</td>

<td>-</td>

</tr>

<tr>

<td>2.0.4</td>

<td>Feb 15</td>

<td>8</td>

<td>-</td>

</tr>

<tr>

<td>2.0.5</td>

<td>Apr 15</td>

<td>8</td>

<td>-</td>

</tr>

<tr>

<td>3.0.0(Mars)</td>

<td>Jun 15</td>

<td>213</td>

<td>35</td>

</tr>

<tr>
<td></td>
<td></td>
<td><strong>426</strong></td>
<td><strong>64</strong></td>
</tr>

</tbody>

</table>

<p>This release is the first one on which the team worked at <em>full speed</em>, so for the future you can expect the same amount of work done.</p>

<h2 id="make-it-better">Make it better</h2>

<p>Their goal was to provide a better tooling for the end users by improving the diagram user experience. This work started with Sirius 2.0 and some of the following features are there since then.</p>

<h3 id="resizing-a-container">Resizing a container</h3>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/containerResize-changedBehavior_old.gif" alt="" /></p>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/containerResize-changedBehavior_new.gif" alt="" /></p>

<h3 id="positioning-elements">Positioning elements</h3>

<table>

<tbody>
<tr>
<td><em>Snap To Shape</em> enabled by default for new diagrams</td>
<td><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/snap_to_shape.png" alt="" border="0" /></td>
</tr>
<tr>
<td><em>Snap To Grid</em> now used when an element is created</td>
<td><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/snap_to_grid.png" alt="" border="0" /></td>
</tr>
<tr>
<td><em>Resize</em> no longer change ports or children’s location</td>
<td><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/resize_ports.png" alt="" border="0" /></td>
</tr>
<tr>
<td>Actions to <em>distribute</em> shapes</td>
<td><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/shapes_distribution.png" alt="" border="0" /></td>
</tr>
<tr>
<td>Action to <em>reset the diagram origin</em></td>
<td><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/reset.png" alt="" border="0" /></td>
</tr>
</tbody>
</table>

<h3 id="edges-layouting">Edges layouting</h3>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/moveNode-edgeImpact-changedBehavior_old.gif" alt="" /></p>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/moveNode-edgeImpact-changedBehavior_new.gif" alt="" /></p>

<h3 id="beautiful-editor">Beautiful editor</h3>

<p>The editor was also improved to provide:</p>

<ul>
  <li>Anchor on borders: Now the edges are linked closely to the images, you just need to define images with an transparent background.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/imageborder-after.png" alt="" /></p>

<ul>
  <li>Underlined and strike through style for labels</li>
</ul>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/underline.png" alt="" /></p>

<ul>
  <li>Compartments: There are two new values available for a container mapping <code class="language-plaintext highlighter-rouge">Vertical Stack</code> and <code class="language-plaintext highlighter-rouge">Horizontal Stack</code>. This means that the defined container will show its children as a vertical/horizontal stack of compartments. Thanks to this new feature, you are able to define a dynamic number of compartments.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/compartments.png" alt="" /></p>

<p>Compartments are just a specific setting of a full blown container mapping making it easy to create any <a href="http://melb.enix.org/sirius/artificial-container/">artificial level</a> of compartments independently from the metamodel structure.</p>

<p>Have a look at the <a href="http://www.eclipse.org/sirius/doc/specifier/diagrams/Diagrams.html#compartments">Sirius compartments documentation</a> for more details.</p>

<h2 id="do-it-faster">Do it faster</h2>

<p>The goal was to get a runtime which react well with 1 million elements. Why one million? Because it is a beautiful number… but also because we noted that the modeling projects are fastly growing to 200K elements and 500K in case of in-depth analysis. Usually when you are over 500K, it means it’s time to re-think the process as you will likely need to decouple models with a clear and defined life-cycle. That is why we aim Sirius to work with 1 millions, then it will be really smoothly with the more usual 500K use case.</p>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/sirius2-bigmodel2.png" alt="" /></p>

<p>Sirius performances are in constant improvements, and this version comes with significant enhancements on heap consumption and time execution.</p>

<table>

<tbody>

<tr>

<th>Time (sec)</th>

<th>Heap (Mb)</th>

<th>Time Variation</th>

<th>Heap Variation</th>

</tr>

<tr>

<td>Open Huge Project</td>

<td>80</td>

<td>276</td>

<td>-31,00%</td>

<td>-20,00%</td>

</tr>

<tr>

<td>Open Big Class Diagram</td>

<td>11</td>

<td>24</td>

<td>-54,00%</td>

<td>+20,00%</td>

</tr>

<tr>

<td>Refresh Big Class Diagram</td>

<td>0,731</td>

<td>0</td>

<td>-18,00%</td>

<td>0,00%</td>

</tr>

<tr>

<td>Save After Diagram Change</td>

<td>26</td>

<td>0</td>

<td>-23,00%</td>

<td>0,00%</td>

</tr>

<tr>

<td>Close Diagram</td>

<td>0,1</td>

<td>-6</td>

<td>0,00%</td>

<td>0,00%</td>

</tr>

<tr>

<td>Close Project</td>

<td>55</td>

<td>294</td>

<td>0,00%</td>

<td>0,00%</td>

</tr>

</tbody>

</table>

<p>On big operations, the model footprint is reduced by 20%. To do so, major work was done on:</p>

<ul>
  <li>using MinimalEObject</li>
  <li>Transforming Colors from full-blown EObject into Immutable DataType</li>
  <li>Detecting and fixing leaks</li>
  <li>Reducing the usage of adapters.</li>
</ul>

<p>Then the save strategy was reviewed as well as the diagram refresh and the image cache.</p>

<p>Another big task was to reduce the latency. First, on the UI runtime:</p>

<ul>
  <li>model element selection dialogs must be used for big models.</li>
  <li>the right-click in the explorer was optimized.</li>
  <li>and the property views made with <a href="https://eclipse.org/eef/">EEF</a> are better integrated.</li>
</ul>

<p>And then to reduce the latency on tables, SWT refreshes are now done in batch and the team also improved the table model refresh.</p>

<p>Performance is also your matter! It really depends on your .odesign specification. You should focus on queries which will have a complexity depending on the size of the model: measure, improve and repeat! Think about using the Sirius embedded profiler:<br />
<img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/sirius-profiler.png" alt="" /></p>

<h2 id="make-us-stronger">Make us stronger</h2>

<h3 id="definition-tooling">Definition tooling</h3>

<p>The Sirius team also worked to polish the specifier editor. They improved many different small things which will really enhance the specifier work as it will guarantee a better odesign validation and an efficient navigation.</p>

<ul>
  <li>Workspace class loading is BACK: With Sirius 3 you can define Java services and then try them directly in your current development environment, you do not need anymore to launch another runtime just to test your services!</li>
  <li>Image path validation and selection wizard: Now, there is a selection wizard to choose an image and then validation exists on image path. You will never get a <em>not found</em> image.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/image_path_validation.png" alt="" /></p>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/select_image.png" alt="" /></p>

<ul>
  <li>Quick Outline: An awesome improvement: it allows to quickly find any element in a <em>odesign</em>! Just call <code class="language-plaintext highlighter-rouge">Ctrl+O</code> and a wizard shows up to help you searching through the viewpoint specification.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/quick_outline.png" alt="" /></p>

<ul>
  <li>Prioritized sub menus: Another great thing, the menus have been reordered and now the most used elements are available at the top.</li>
</ul>

<h3 id="query-languages">Query languages</h3>

<p>If you are used to work with Sirius, you already know that writing queries can turn to a severe headache due to the lack of detailed <em>type</em> information.<br />
<img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/queries-in-odesign.png" alt="" /></p>

<p>Actually, there are in Sirius 5 different interpreters to write your queries:</p>

<ul>
  <li>Feature: <code class="language-plaintext highlighter-rouge">feature:</code></li>
  <li>Service: <code class="language-plaintext highlighter-rouge">service:</code></li>
  <li>Var: <code class="language-plaintext highlighter-rouge">var:</code></li>
  <li>MTL: <code class="language-plaintext highlighter-rouge">[/]</code></li>
  <li>and the legacy one: <code class="language-plaintext highlighter-rouge">&lt;%%&gt;</code></li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">.odesign</code> specification is as flexible as possible, tools can be reused among mappings, mappings can be reused by other mappings, but that means one variable definition can actually have several types depending on the <code class="language-plaintext highlighter-rouge">.odesign</code> structure. If we have a look at the following query: <em>What is the type of var:source?</em><br />
<img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/typed-edge-mapping.png" alt="" /> <img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/typed-edge-creation.png" alt="" /></p>

<p>Regarding our example, source can be a <em>Man</em> or a <em>Woman</em> but it could be <em>Woman</em> or <em>Package</em>. Then the source variable can be of multiple types and those types may have no common ancestor other than <code class="language-plaintext highlighter-rouge">EObject</code>.</p>

<p>Type analysis within the action language requires a stronger type information from interpreters. It is implemented in <code class="language-plaintext highlighter-rouge">feature:</code>, <code class="language-plaintext highlighter-rouge">var:</code>. We made some improvements in <code class="language-plaintext highlighter-rouge">[/]</code> and there is simply no support in legacy <code class="language-plaintext highlighter-rouge">&lt;%%&gt;</code> and <code class="language-plaintext highlighter-rouge">ocl:</code>. What we want is a good reference support.</p>

<p>The <a href="https://www.eclipse.org/sirius/doc/specifier/general/Writing_Queries.html#aql">Acceleo Query Language</a> also known as AQL comes to our rescue. The implementation of AQL is specifically tailored for the Sirius use case. We have many variables for a given expression and <em>null</em> values are common. The usage is really interactive and so the context is constantly changing. I can hear you “Hoooo no, not yet <em>another</em> language…”. Don’t be afraid! You know OCL ? Then you know AQL.</p>

<p>The most important things to know is that:</p>

<ul>
  <li>You will find the classic operations like <code class="language-plaintext highlighter-rouge">filter</code>, <code class="language-plaintext highlighter-rouge">collect</code>,</li>
  <li>And some convenient ones as: <code class="language-plaintext highlighter-rouge">eInverse()</code>, <code class="language-plaintext highlighter-rouge">eResource()</code>…</li>
  <li>
    <p>There is <strong>no</strong> implicit variable:</p>

    <p><code class="language-plaintext highlighter-rouge">[name/]</code> is invalid becomes <code class="language-plaintext highlighter-rouge">self.name</code></p>

    <p><code class="language-plaintext highlighter-rouge">[self.eContents()-&gt;select(name.startsWith('A'))/]</code> is invalid and becomes <code class="language-plaintext highlighter-rouge">self.eContents()-&gt;select(i | i.name.startsWith('A')</code></p>

    <p><code class="language-plaintext highlighter-rouge">self.referenceWithNoValue.someOtherAttribute</code> has no evaluation error, returns <code class="language-plaintext highlighter-rouge">"Nothing"</code></p>
  </li>
</ul>

<p>AQL is not strictly compatible with MTL but a subset of MTL works for both.</p>

<p>We did some benchmarks with the different queries engines available in Sirius:<br />
<img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/sirius-query-bench.png" alt="" /></p>

<p>There is no good reason not to use it considering the overhead vs the flexibility and strong validation. In Sirius 3.0, it is delivered as an experimental feature but it will be available officially for the next 3.1 release.<br />
<img src="https://raw.githubusercontent.com/mbats/sirius-blog/master/sirius3/blog/images/install-aql.png" alt="" /></p>

<p>So consider using it from now on if you are still using Acceleo 2 expressions (<code class="language-plaintext highlighter-rouge">&lt;%%&gt;</code>). Otherwise, if you are using MTL (<code class="language-plaintext highlighter-rouge">[/]</code>), you can prepare your queries to make the migration easier.</p>

<p>To get more details about what is arriving in Sirius 3.0, have a look at the <a href="http://www.eclipse.org/sirius/doc/Release_Notes.html">release notes</a> and to the <a href="http://cedric.brun.io/talks/">slides</a> or the <a href="https://youtu.be/4LzafNP5HNk?t=16445">video</a> of <a href="http://cedric.brun.io/">Cédric Brun</a> EclipseCon France talk.</p>

<p>Even if Sirius 3.0 is major version, don’t be afraid! The models are automatically migrated by Sirius, the API changes are well documented in the release notes and some projects such as <a href="http://www.eclipse.org/ecoretools/">EcoreTools</a> or <a href="http://www.umldesigner.org">UML Designer</a> could upgrade just by changing the version range in the plugin, no impact on the code.</p>

<p>The 3.1 version is planned for November and the next topics of work will be: more flexibility for diagram UX, compartments feature complete, bullet-proof AQL and again more performance and scalability improvements… and your priority is our priority for the future. So don’t be shy, report what you need and want on the <a href="https://bugs.eclipse.org/bugs/enter_bug.cgi?product=Sirius">bugzilla</a> and remember you can <a href="http://www.obeodesigner.com/sirius">sponsor us</a> to get it done quickly!</p>

<p>Let’s have <a href="https://en.wikipedia.org/wiki/Daft_Punk">Daft Punk</a> conclude this post:</p>

<blockquote>
  <p>More than ever<br />
Hour after<br />
Our work is<br />
Never over</p>
</blockquote>
:ET